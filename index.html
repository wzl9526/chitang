
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Ink Koi Pond ğŸŸ</title>
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@500&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #eef2f3; /* æµ…ç°ç™½åº• */
            /* å åŠ å®£çº¸çº¹ç† */
            background-image: url('https://www.transparenttextures.com/patterns/rice-paper-2.png');
            font-family: 'Noto Serif SC', serif;
        }
        canvas { display: block; }
        .poem {
            position: absolute;
            top: 10%;
            left: 10%;
            writing-mode: vertical-rl; /* ç«–æ’ */
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 28px;
            color: #2c3e50;
            opacity: 0.8;
            pointer-events: none;
            line-height: 50px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        .instruction {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: #888;
            font-size: 14px;
            pointer-events: none;
            letter-spacing: 2px;
        }
    </style>
</head>
<body>
    <div class="poem">
        æ±Ÿå—å¯é‡‡è²<br>è²å¶ä½•ç”°ç”°<br>é±¼æˆè²å¶é—´<br>é±¼æˆè²å¶ä¸œ<br>é±¼æˆè²å¶è¥¿
    </div>
    <canvas id="canvas"></canvas>
    <div class="instruction">- ç§»åŠ¨é¼ æ ‡å–‚é£Ÿé”¦é²¤ Â· Click to Ripple -</div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let mouse = { x: 0, y: 0 };

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            initPond();
        }
        window.addEventListener('resize', resize);
        window.addEventListener('mousemove', e => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
            // é¼ æ ‡ç§»åŠ¨äº§ç”Ÿç»†å¾®æ³¢çº¹
            if(Math.random() > 0.8) ripples.push(new Ripple(mouse.x, mouse.y, 1));
        });
        window.addEventListener('click', e => {
            ripples.push(new Ripple(e.clientX, e.clientY, 3));
        });

        // --- åŸºç¡€å‘é‡ç±» (ç”¨äºç”Ÿç‰©è¿åŠ¨è®¡ç®—) ---
        class Vector {
            constructor(x, y) { this.x = x; this.y = y; }
            add(v) { return new Vector(this.x + v.x, this.y + v.y); }
            sub(v) { return new Vector(this.x - v.x, this.y - v.y); }
            mult(n) { return new Vector(this.x * n, this.y * n); }
            mag() { return Math.sqrt(this.x*this.x + this.y*this.y); }
            normalize() {
                let m = this.mag();
                return m === 0 ? new Vector(0,0) : new Vector(this.x/m, this.y/m);
            }
        }

        // --- ç±»å®šä¹‰ ---

        // 1. æ¶Ÿæ¼ª (Ripple)
        class Ripple {
            constructor(x, y, power) {
                this.x = x; this.y = y;
                this.r = 1;
                this.opacity = 0.5 * power;
                this.power = power;
            }
            update() {
                this.r += 2;
                this.opacity -= 0.01;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.r, 0, Math.PI*2);
                ctx.strokeStyle = `rgba(100, 149, 237, ${this.opacity})`;
                ctx.lineWidth = 1 + this.power;
                ctx.stroke();
            }
        }

        // 2. è·å¶ (Lotus Leaf) - é™æ€èƒŒæ™¯ç”Ÿæˆ
        class Lotus {
            constructor() {
                this.x = Math.random() * width;
                this.y = Math.random() * height;
                this.size = Math.random() * 60 + 40;
                this.color = `rgba(47, 79, 79, ${Math.random()*0.3 + 0.5})`; // å¢¨ç»¿è‰²
                this.angle = Math.random() * Math.PI * 2;
                // ç¼ºå£è§’åº¦
                this.gapAngle = this.angle + Math.PI; 
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);

                // ç”»å¶å­ (å¸¦ç¼ºå£çš„åœ†)
                ctx.beginPath();
                ctx.arc(0, 0, this.size, 0.1, Math.PI * 1.9); // ç•™ä¸ªç¼ºå£
                ctx.lineTo(0, 0); // è¿å›ä¸­å¿ƒ
                ctx.fillStyle = this.color;
                ctx.fill();

                // ç”»å¶è„‰
                ctx.strokeStyle = "rgba(0,0,0,0.1)";
                ctx.lineWidth = 1;
                for(let i=0; i<8; i++) {
                    ctx.beginPath();
                    ctx.moveTo(0,0);
                    ctx.lineTo(Math.cos(i*Math.PI/4)*this.size, Math.sin(i*Math.PI/4)*this.size);
                    ctx.stroke();
                }
                ctx.restore();
            }
        }

        // 3. é”¦é²¤ (Koi Fish) - æ ¸å¿ƒéš¾ç‚¹
        class Koi {
            constructor() {
                this.pos = new Vector(Math.random()*width, Math.random()*height);
                this.vel = new Vector(Math.random()-0.5, Math.random()-0.5);
                this.acc = new Vector(0,0);
                this.maxSpeed = 2 + Math.random();
                this.maxForce = 0.05;

                // èº«ä½“åˆ†æ®µ (è„ŠæŸ±)
                this.history = []; 
                this.len = 15; // èº«ä½“é•¿åº¦
                for(let i=0; i<this.len; i++) {
                    this.history.push(this.pos);
                }

                // é¢œè‰² (çº¢ç™½ æˆ– é‡‘è‰²)
                this.type = Math.random() > 0.5 ? 'red' : 'gold';
            }

            // è¿½é€é¼ æ ‡
            seek(target) {
                let desired = new Vector(target.x, target.y).sub(this.pos);
                let d = desired.mag();
                desired = desired.normalize();

                if (d < 100) { // é è¿‘æ—¶å‡é€Ÿ
                    desired = desired.mult(this.maxSpeed * (d/100));
                } else {
                    desired = desired.mult(this.maxSpeed);
                }

                let steer = desired.sub(this.vel);
                // é™åˆ¶è½¬å‘åŠ›
                let m = steer.mag();
                if(m > this.maxForce) steer = steer.normalize().mult(this.maxForce);

                this.acc = this.acc.add(steer);
            }

            update() {
                // 1. ç‰©ç†è¿åŠ¨
                this.seek(mouse); // æ€»æ˜¯è¢«é¼ æ ‡å¸å¼•
                this.vel = this.vel.add(this.acc);
                // é™åˆ¶é€Ÿåº¦
                let s = this.vel.mag();
                if(s > this.maxSpeed) this.vel = this.vel.normalize().mult(this.maxSpeed);

                this.pos = this.pos.add(this.vel);
                this.acc = new Vector(0,0); // é‡ç½®åŠ é€Ÿåº¦

                // 2. æ›´æ–°è„ŠæŸ± (èº«ä½“è·Ÿéšå¤´éƒ¨)
                this.history.unshift(this.pos);
                this.history.pop();
            }

            draw() {
                // èº«ä½“åŠå¾„éšä½ç½®å˜åŒ– (å¤´å¤§å°¾å°)
                const getRadius = (i) => {
                    if (i < 3) return 8 + i; // å¤´éƒ¨æ¸å®½
                    return 12 - i * 0.8; // èº«ä½“æ¸ç»†
                };

                // ç»˜åˆ¶èº«ä½“ (è¿æ¥åœ†)
                for (let i = 0; i < this.history.length; i++) {
                    let p = this.history[i];
                    let r = getRadius(i);
                    if (r < 0) r = 1;

                    ctx.beginPath();
                    ctx.arc(p.x, p.y, r, 0, Math.PI * 2);

                    // é¢œè‰²å¤„ç†ï¼šæ°´å¢¨é£å¸¦ä¸€ç‚¹è‰²å½©
                    if (this.type === 'red') {
                        // å¤´éƒ¨çº¢è‰²ï¼Œå°¾éƒ¨ç™½è‰²æ¸å˜
                        ctx.fillStyle = i < 5 ? "rgba(220, 20, 60, 0.8)" : "rgba(240, 240, 240, 0.6)"; 
                    } else {
                        // é‡‘è‰²
                        ctx.fillStyle = i < 5 ? "rgba(218, 165, 32, 0.8)" : "rgba(255, 255, 224, 0.6)";
                    }

                    // ç»™èº«ä½“åŠ ä¸€ç‚¹å¢¨è¾¹
                    ctx.shadowBlur = 2;
                    ctx.shadowColor = "rgba(0,0,0,0.2)";
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }

                // ç®€å•çš„é±¼é³ (åœ¨ç¬¬4èŠ‚èº«ä½“å¤„ç”»)
                if(this.history[3]) {
                    let p = this.history[3];
                    // è®¡ç®—èº«ä½“æ–¹å‘
                    let angle = Math.atan2(this.vel.y, this.vel.x);
                    ctx.save();
                    ctx.translate(p.x, p.y);
                    ctx.rotate(angle);

                    ctx.fillStyle = "rgba(255, 255, 255, 0.4)";
                    // å·¦é³
                    ctx.beginPath(); ctx.ellipse(5, -10, 8, 3, Math.PI/4, 0, Math.PI*2); ctx.fill();
                    // å³é³
                    ctx.beginPath(); ctx.ellipse(5, 10, 8, 3, -Math.PI/4, 0, Math.PI*2); ctx.fill();
                    ctx.restore();
                }
            }
        }

        // --- ä¸»ç¨‹åº ---
        const ripples = [];
        const lotuses = [];
        const fishSchool = [];

        function initPond() {
            mouse.x = width / 2;
            mouse.y = height / 2;

            lotuses.length = 0;
            fishSchool.length = 0;

            // ç”Ÿæˆè·å¶
            for(let i=0; i<12; i++) lotuses.push(new Lotus());

            // ç”Ÿæˆé”¦é²¤ç¾¤
            for(let i=0; i<8; i++) fishSchool.push(new Koi());
        }

        function animate() {
            ctx.clearRect(0, 0, width, height);

            // 1. ç”»è·å¶ (åº•å±‚)
            lotuses.forEach(l => l.draw());

            // 2. ç”»æ¶Ÿæ¼ª
            for (let i = ripples.length - 1; i >= 0; i--) {
                let r = ripples[i];
                r.update();
                r.draw();
                if (r.opacity <= 0) ripples.splice(i, 1);
            }

            // 3. ç”»é±¼
            fishSchool.forEach(fish => {
                fish.update();
                fish.draw();
            });

            requestAnimationFrame(animate);
        }

        resize();
        animate();

    </script>
</body>
</html>
